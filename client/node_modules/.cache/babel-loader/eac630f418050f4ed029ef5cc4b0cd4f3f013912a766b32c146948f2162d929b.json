{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\\\u0410\\u043D\\u0434\\u0440\\u0435\\u0439\\\\Work\\\\Map\\\\client\\\\src\\\\MapView.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from \"react\";\nimport L from \"leaflet\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function MapView() {\n  _s();\n  const mapRef = useRef(null);\n  const [config, setConfig] = useState(null);\n  const [players, setPlayers] = useState([]);\n  const playerIcon = name => L.divIcon({\n    className: \"player-icon\",\n    html: `<div style=\"\n        background-image:url('https://mc-heads.net/avatar/${name}/32');\n        width:32px; height:32px;\n        border-radius:50%;\n        border: 2px solid white;\n        background-size: cover;\n      \"></div>`,\n    iconSize: [32, 32]\n  });\n  useEffect(() => {\n    fetch(\"/map/config\").then(res => res.json()).then(setConfig);\n  }, []);\n  useEffect(() => {\n    if (!config) return;\n    if (mapRef.current) {\n      mapRef.current.remove();\n      mapRef.current = null;\n    }\n    const [tx, tz] = config.top_left;\n    const [bx, bz] = config.bottom_right;\n    const bounds = [[Math.min(tz, bz), Math.min(tx, bx)], [Math.max(tz, bz), Math.max(tx, bx)]];\n    const map = L.map(\"map\", {\n      crs: L.CRS.Simple\n    });\n    L.imageOverlay(\"/maps/map.png\", bounds).addTo(map);\n    map.fitBounds(bounds);\n    mapRef.current = map;\n    const socket = new WebSocket(`ws://${window.location.hostname}:8000/ws`);\n    socket.onmessage = e => {\n      const data = JSON.parse(e.data);\n      if (data.type === \"player_position\") {\n        setPlayers(prev => {\n          const others = prev.filter(p => p.name !== data.name);\n          return [...others, {\n            name: data.name,\n            x: data.x,\n            z: data.z\n          }];\n        });\n      }\n    };\n    return () => socket.close();\n  }, [config]);\n  useEffect(() => {\n    if (!mapRef.current) return;\n    mapRef.current.eachLayer(layer => {\n      if (layer.options && layer.options.pane === \"markerPane\") {\n        mapRef.current.removeLayer(layer);\n      }\n    });\n    players.forEach(({\n      name,\n      x,\n      z\n    }) => {\n      L.marker([z, x], {\n        icon: playerIcon(name)\n      }).addTo(mapRef.current);\n    });\n  }, [players]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"map\",\n    style: {\n      height: \"80vh\",\n      width: \"100%\"\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 10\n  }, this);\n}\n_s(MapView, \"pVP2KQZEnmX7SdeL4eKbT2GHvOg=\");\n_c = MapView;\nvar _c;\n$RefreshReg$(_c, \"MapView\");","map":{"version":3,"names":["React","useEffect","useState","useRef","L","jsxDEV","_jsxDEV","MapView","_s","mapRef","config","setConfig","players","setPlayers","playerIcon","name","divIcon","className","html","iconSize","fetch","then","res","json","current","remove","tx","tz","top_left","bx","bz","bottom_right","bounds","Math","min","max","map","crs","CRS","Simple","imageOverlay","addTo","fitBounds","socket","WebSocket","window","location","hostname","onmessage","e","data","JSON","parse","type","prev","others","filter","p","x","z","close","eachLayer","layer","options","pane","removeLayer","forEach","marker","icon","id","style","height","width","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Андрей/Work/Map/client/src/MapView.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport L from \"leaflet\";\r\n\r\nexport default function MapView() {\r\n  const mapRef = useRef(null);\r\n  const [config, setConfig] = useState(null);\r\n  const [players, setPlayers] = useState([]);\r\n\r\n  const playerIcon = (name) =>\r\n    L.divIcon({\r\n      className: \"player-icon\",\r\n      html: `<div style=\"\r\n        background-image:url('https://mc-heads.net/avatar/${name}/32');\r\n        width:32px; height:32px;\r\n        border-radius:50%;\r\n        border: 2px solid white;\r\n        background-size: cover;\r\n      \"></div>`,\r\n      iconSize: [32, 32],\r\n    });\r\n\r\n  useEffect(() => {\r\n    fetch(\"/map/config\").then(res => res.json()).then(setConfig);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!config) return;\r\n    if (mapRef.current) {\r\n      mapRef.current.remove();\r\n      mapRef.current = null;\r\n    }\r\n\r\n    const [tx, tz] = config.top_left;\r\n    const [bx, bz] = config.bottom_right;\r\n    const bounds = [\r\n      [Math.min(tz, bz), Math.min(tx, bx)],\r\n      [Math.max(tz, bz), Math.max(tx, bx)]\r\n    ];\r\n\r\n    const map = L.map(\"map\", { crs: L.CRS.Simple });\r\n    L.imageOverlay(\"/maps/map.png\", bounds).addTo(map);\r\n    map.fitBounds(bounds);\r\n    mapRef.current = map;\r\n\r\n    const socket = new WebSocket(`ws://${window.location.hostname}:8000/ws`);\r\n    socket.onmessage = (e) => {\r\n      const data = JSON.parse(e.data);\r\n      if (data.type === \"player_position\") {\r\n        setPlayers((prev) => {\r\n          const others = prev.filter(p => p.name !== data.name);\r\n          return [...others, { name: data.name, x: data.x, z: data.z }];\r\n        });\r\n      }\r\n    };\r\n\r\n    return () => socket.close();\r\n  }, [config]);\r\n\r\n  useEffect(() => {\r\n    if (!mapRef.current) return;\r\n    mapRef.current.eachLayer(layer => {\r\n      if (layer.options && layer.options.pane === \"markerPane\") {\r\n        mapRef.current.removeLayer(layer);\r\n      }\r\n    });\r\n    players.forEach(({ name, x, z }) => {\r\n      L.marker([z, x], { icon: playerIcon(name) }).addTo(mapRef.current);\r\n    });\r\n  }, [players]);\r\n\r\n  return <div id=\"map\" style={{ height: \"80vh\", width: \"100%\" }} />;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}